schema: '2.0'
stages:
  train:
    cmd: python code/tiny_train.py
    deps:
    - path: code/bert_dataset.py
      hash: md5
      md5: 78c854fac71d12bdf81248aedc613185
      size: 18709
    - path: code/tiny_train.py
      hash: md5
      md5: 978ddd87c5e630823a3896cf3e730f6c
      size: 3691
    params:
      params.yaml:
        train.batch_size: 64
        train.d_model: 768
        train.dropout: 0.1
        train.epochs: 5
        train.heads: 12
        train.lr: 5e-05
        train.weight_decay: 0.01
    outs:
    - path: models/tinybert_saved_model
      hash: md5
      md5: 7d34ea52fc26a0cfd22389df3ad4c5f8.dir
      size: 18495514
      nfiles: 6
  export:
    cmd: python code/export.py
    deps:
    - path: code/export.py
      hash: md5
      md5: fedac6700d97389ffbb411c07d4f19c3
      size: 1529
    - path: models/tinybert_saved_model
      hash: md5
      md5: 7d34ea52fc26a0cfd22389df3ad4c5f8.dir
      size: 18495514
      nfiles: 6
    outs:
    - path: models/tinybert.onnx
      hash: md5
      md5: 8382011a094e30a047a433c6a59d79f4
      size: 17603568
  evaluate:
    cmd: python code/evaluate_model.py
    deps:
    - path: code/evaluate_model.py
      hash: md5
      md5: 37a1f19cebb3e0729722da19c0d3db9e
      size: 2854
    - path: models/tinybert_saved_model
      hash: md5
      md5: 7d34ea52fc26a0cfd22389df3ad4c5f8.dir
      size: 18495514
      nfiles: 6
  measure:
    cmd: FP16=0 python code/measure.py
    deps:
    - path: code/measure.py
      hash: md5
      md5: c02f58a3477fa591f840c91a6910b0df
      size: 17917
    - path: code/plot_templates/bar_1.json
      hash: md5
      md5: 92dcdaeb45f5549aeab0ff00c7a2080f
      size: 515
    - path: code/plot_templates/bar_2.json
      hash: md5
      md5: f2eefbc5bd57f494a0a012014d81c247
      size: 528
    - path: code/plot_templates/bar_3.json
      hash: md5
      md5: 724e294ba3613e4bacf9facee611f1c6
      size: 609
    - path: code/plot_templates/bar_4.json
      hash: md5
      md5: f5e4670f077f4d7a744fb542c235b7b3
      size: 629
    - path: datasets/tokenized_agnews_test.pt
      hash: md5
      md5: db0ea7f0705e65f4873ac08d1a160cc8
      size: 15627446
    - path: models/model.onnx
      hash: md5
      md5: 591890517e978faec1b1186af50f03bd
      size: 17639925
    - path: models/tinybert_saved_model
      hash: md5
      md5: 7d34ea52fc26a0cfd22389df3ad4c5f8.dir
      size: 18495514
      nfiles: 6
    params:
      params.yaml:
        measure.batch_sizes:
        - 1
        - 2
        - 4
        - 8
        - 16
        - 32
        - 64
        - 128
        - 256
        - 512
        - 1024
    outs:
    - path: eval_results/accuracy_FP32.json
      hash: md5
      md5: fe53e1c2680ce9ebb69767f6746e554d
      size: 68
    - path: throughput/FP32/latency_results.json
      hash: md5
      md5: 11e7bb4523d7bd62f9a7b08c694bb77b
      size: 3593
    - path: throughput/FP32/latency_results_batch.json
      hash: md5
      md5: 303f77918d5d2d867b5a50e04b353a3d
      size: 3560
    - path: throughput/FP32/throughput_results.json
      hash: md5
      md5: 4a6a33c72a6dd6880a333f3bad6b9527
      size: 1624
    - path: throughput/FP32/throughput_results_2.json
      hash: md5
      md5: 4a6a33c72a6dd6880a333f3bad6b9527
      size: 1624
  quantize:
    cmd: python code/brevitas_quant.py
    deps:
    - path: code/brevitas_quant.py
      hash: md5
      md5: b6a4d2beb8859f1f8554986f8a3d6c6e
      size: 1426
    - path: models/tinybert_saved_model
      hash: md5
      md5: 7d34ea52fc26a0cfd22389df3ad4c5f8.dir
      size: 18495514
      nfiles: 6
    outs:
    - path: models/model.onnx
      hash: md5
      md5: 591890517e978faec1b1186af50f03bd
      size: 17639925
  quantize_INT8:
    cmd: python code/brevitas_quant.py
    deps:
    - path: code/brevitas_quant.py
      hash: md5
      md5: 839d219fdd880e3bb2b12d77a75067c4
      size: 1429
    - path: models/tinybert_saved_model
      hash: md5
      md5: 7d34ea52fc26a0cfd22389df3ad4c5f8.dir
      size: 18495514
      nfiles: 6
    outs:
    - path: models/tinybert_int8/model.onnx
      hash: md5
      md5: 591890517e978faec1b1186af50f03bd
      size: 17639925
  measure_FP16:
    cmd: FP16=1 python code/measure.py
    deps:
    - path: code/measure.py
      hash: md5
      md5: c02f58a3477fa591f840c91a6910b0df
      size: 17917
    - path: code/plot_templates/bar_1_FP16.json
      hash: md5
      md5: 3c25e7ae673fcfc1779fe671ef5ef71a
      size: 515
    - path: code/plot_templates/bar_2_FP16.json
      hash: md5
      md5: 79f90683e1ad613c2a33e08b5d49ee92
      size: 528
    - path: code/plot_templates/bar_3_FP16.json
      hash: md5
      md5: 74398b2c22a2bcaa7854e77e392157e4
      size: 609
    - path: code/plot_templates/bar_4_FP16.json
      hash: md5
      md5: 63b5209bc3d81801d31dd9e198920e3f
      size: 629
    - path: datasets/tokenized_agnews_test.pt
      hash: md5
      md5: db0ea7f0705e65f4873ac08d1a160cc8
      size: 15627446
    - path: models/model.onnx
      hash: md5
      md5: 591890517e978faec1b1186af50f03bd
      size: 17639925
    - path: models/tinybert_saved_model
      hash: md5
      md5: 7d34ea52fc26a0cfd22389df3ad4c5f8.dir
      size: 18495514
      nfiles: 6
    params:
      params.yaml:
        measure.batch_sizes:
        - 1
        - 2
        - 4
        - 8
        - 16
        - 32
        - 64
        - 128
        - 256
        - 512
        - 1024
    outs:
    - path: eval_results/accuracy_FP16.json
      hash: md5
      md5: a53bd510aa0409dd11a24b835be97591
      size: 68
    - path: throughput/FP16/latency_results.json
      hash: md5
      md5: 4bf84f36537b3e5a71d7fa5bb1ec76d7
      size: 3610
    - path: throughput/FP16/latency_results_batch.json
      hash: md5
      md5: 3bdb3bb84dca4f1f5234365bfe4fdff5
      size: 3558
    - path: throughput/FP16/throughput_results.json
      hash: md5
      md5: c9bb171b6ddf4ee79a4740240eee1a17
      size: 1623
    - path: throughput/FP16/throughput_results_2.json
      hash: md5
      md5: c9bb171b6ddf4ee79a4740240eee1a17
      size: 1623
  measure_INT8:
    cmd: python code/measure_int8.py
    deps:
    - path: code/measure_int8.py
      hash: md5
      md5: c671b6df0515b96a301543705cd112c0
      size: 18155
    - path: code/plot_templates/bar_1_INT8.json
      hash: md5
      md5: 512d0d97671e22f804d637ba1230baff
      size: 515
    - path: code/plot_templates/bar_2_INT8.json
      hash: md5
      md5: 079cf62477a8b45cfd74c52f9c826f00
      size: 528
    - path: code/plot_templates/bar_3_INT8.json
      hash: md5
      md5: a44e05205624dcffd0bf99af17df8027
      size: 609
    - path: code/plot_templates/bar_4_INT8.json
      hash: md5
      md5: 9a82c709579ef72d64518fa009ddee1f
      size: 629
    - path: datasets/tokenized_agnews_test.pt
      hash: md5
      md5: db0ea7f0705e65f4873ac08d1a160cc8
      size: 15627446
    - path: models/tinybert_int8/model.onnx
      hash: md5
      md5: 591890517e978faec1b1186af50f03bd
      size: 17639925
    - path: models/tinybert_saved_model
      hash: md5
      md5: 7d34ea52fc26a0cfd22389df3ad4c5f8.dir
      size: 18495514
      nfiles: 6
    params:
      params.yaml:
        measure.batch_sizes:
        - 1
        - 2
        - 4
        - 8
        - 16
        - 32
        - 64
        - 128
        - 256
        - 512
        - 1024
    outs:
    - path: eval_results/accuracy_INT8.json
      hash: md5
      md5: 516b6377182eb93df874b4895a95ec19
      size: 68
    - path: throughput/INT8/latency_results.json
      hash: md5
      md5: 845a578efc99a21d389fbd90a9451091
      size: 3601
    - path: throughput/INT8/latency_results_batch.json
      hash: md5
      md5: 5eebc92dd622d57c5a6cf8f6f1b47f89
      size: 3560
    - path: throughput/INT8/throughput_results.json
      hash: md5
      md5: b8d13a12ec4fdf85fd0ec4c4cc45c1ab
      size: 1625
    - path: throughput/INT8/throughput_results_2.json
      hash: md5
      md5: b8d13a12ec4fdf85fd0ec4c4cc45c1ab
      size: 1625
  accuracy_comparison:
    cmd: python code/accuracy_comparison.py
    deps:
    - path: code/accuracy_comparison.py
      hash: md5
      md5: 293850b3ac200c49c43eae06737d49c4
      size: 832
    - path: eval_results/accuracy_FP16.json
      hash: md5
      md5: a53bd510aa0409dd11a24b835be97591
      size: 68
    - path: eval_results/accuracy_FP32.json
      hash: md5
      md5: fe53e1c2680ce9ebb69767f6746e554d
      size: 68
    - path: eval_results/accuracy_INT8.json
      hash: md5
      md5: 516b6377182eb93df874b4895a95ec19
      size: 68
    outs:
    - path: eval_results/accuracy.json
      hash: md5
      md5: f09a978e7effddc271b2b588c6b6d32a
      size: 260
