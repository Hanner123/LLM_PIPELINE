schema: '2.0'
stages:
  train:
    cmd: python code/tiny_train.py
    deps:
    - path: code/bert_dataset.py
      hash: md5
      md5: 78c854fac71d12bdf81248aedc613185
      size: 18709
    - path: code/tiny_train.py
      hash: md5
      md5: d88092669558600f0e5423104a40f3ba
      size: 3707
    params:
      params.yaml:
        train.batch_size: 64
        train.d_model: 768
        train.dropout: 0.1
        train.epochs: 10
        train.heads: 12
        train.lr: 0.001
        train.weight_decay: 0.01
    outs:
    - path: models/tinybert_saved_model
      hash: md5
      md5: 5c5a661df2b258e8ea0e5bcd288c238c.dir
      size: 18495514
      nfiles: 6
  export:
    cmd: python code/export.py
    deps:
    - path: code/export.py
      hash: md5
      md5: fedac6700d97389ffbb411c07d4f19c3
      size: 1529
    - path: models/tinybert_saved_model
      hash: md5
      md5: 5c5a661df2b258e8ea0e5bcd288c238c.dir
      size: 18495514
      nfiles: 6
    outs:
    - path: models/tinybert.onnx
      hash: md5
      md5: 5343fcd950c7c75e23125de929418e9a
      size: 17603568
  evaluate:
    cmd: python code/evaluate_model.py
    deps:
    - path: code/evaluate_model.py
      hash: md5
      md5: 4011e4487d6efe73bdaf00e9aca2daa4
      size: 3311
    - path: models/tinybert_saved_model
      hash: md5
      md5: 5c5a661df2b258e8ea0e5bcd288c238c.dir
      size: 18495514
      nfiles: 6
  measure:
    cmd: python code/measure_general.py
    deps:
    - path: code/measure.py
      hash: md5
      md5: 297f57e362691a36280e438a441b7d4d
      size: 17915
    - path: code/measure_general.py
      hash: md5
      md5: ce93c358007215235fcd5c7c88602b97
      size: 24119
    - path: code/plot_templates/bar_1.json
      hash: md5
      md5: 92dcdaeb45f5549aeab0ff00c7a2080f
      size: 515
    - path: code/plot_templates/bar_2.json
      hash: md5
      md5: f2eefbc5bd57f494a0a012014d81c247
      size: 528
    - path: code/plot_templates/bar_3.json
      hash: md5
      md5: 724e294ba3613e4bacf9facee611f1c6
      size: 609
    - path: code/plot_templates/bar_4.json
      hash: md5
      md5: f5e4670f077f4d7a744fb542c235b7b3
      size: 629
    - path: datasets/tokenized_agnews_test.pt
      hash: md5
      md5: 1e73b549c83c233f23f3f6c35db9a51d
      size: 15627871
    - path: models/tinybert.onnx
      hash: md5
      md5: 5343fcd950c7c75e23125de929418e9a
      size: 17603568
    - path: models/tinybert_saved_model
      hash: md5
      md5: 5c5a661df2b258e8ea0e5bcd288c238c.dir
      size: 18495514
      nfiles: 6
    params:
      params.yaml:
        measure.batch_sizes:
        - 1
        - 2
        - 4
        - 8
        - 16
        - 32
        - 64
        - 128
        - 256
        - 512
        - 1024
    outs:
    - path: eval_results/accuracy_FP32.json
      hash: md5
      md5: ff4e14772ceefa34274252c24e601710
      size: 54
    - path: throughput/FP32/latency_results.json
      hash: md5
      md5: 89185ebf8b55e5f2632d16490cc4fa75
      size: 3563
    - path: throughput/FP32/latency_results_batch.json
      hash: md5
      md5: c49cbed8f9970e66e90634a06415c59d
      size: 3520
    - path: throughput/FP32/throughput_results.json
      hash: md5
      md5: 5349dc53eb64dee5f9545dc9646fedc9
      size: 1628
    - path: throughput/FP32/throughput_results_2.json
      hash: md5
      md5: 5349dc53eb64dee5f9545dc9646fedc9
      size: 1628
  quantize:
    cmd: python code/brevitas_quant.py
    deps:
    - path: code/brevitas_quant.py
      hash: md5
      md5: b6a4d2beb8859f1f8554986f8a3d6c6e
      size: 1426
    - path: models/tinybert_saved_model
      hash: md5
      md5: 7d34ea52fc26a0cfd22389df3ad4c5f8.dir
      size: 18495514
      nfiles: 6
    outs:
    - path: models/model.onnx
      hash: md5
      md5: 591890517e978faec1b1186af50f03bd
      size: 17639925
  quantize_INT8:
    cmd: python code/brevitas_quant.py
    deps:
    - path: code/brevitas_quant.py
      hash: md5
      md5: 839d219fdd880e3bb2b12d77a75067c4
      size: 1429
    - path: models/tinybert_saved_model
      hash: md5
      md5: 0edfb3bc6aa647bae55e113ac340a5f5.dir
      size: 18495514
      nfiles: 6
    outs:
    - path: models/tinybert_int8/model.onnx
      hash: md5
      md5: 52c4eaf888515f4ae3a33512b0b0ccba
      size: 17639925
  measure_FP16:
    cmd: FP16=1 python code/measure_general.py
    deps:
    - path: code/measure.py
      hash: md5
      md5: 297f57e362691a36280e438a441b7d4d
      size: 17915
    - path: code/measure_general.py
      hash: md5
      md5: ce93c358007215235fcd5c7c88602b97
      size: 24119
    - path: code/plot_templates/bar_1_FP16.json
      hash: md5
      md5: 3c25e7ae673fcfc1779fe671ef5ef71a
      size: 515
    - path: code/plot_templates/bar_2_FP16.json
      hash: md5
      md5: 79f90683e1ad613c2a33e08b5d49ee92
      size: 528
    - path: code/plot_templates/bar_3_FP16.json
      hash: md5
      md5: 74398b2c22a2bcaa7854e77e392157e4
      size: 609
    - path: code/plot_templates/bar_4_FP16.json
      hash: md5
      md5: 63b5209bc3d81801d31dd9e198920e3f
      size: 629
    - path: datasets/tokenized_agnews_test.pt
      hash: md5
      md5: 1e73b549c83c233f23f3f6c35db9a51d
      size: 15627871
    - path: models/tinybert_int8/model.onnx
      hash: md5
      md5: fc21e2cb9a2778c869fcc614a5a60c4d
      size: 17639925
    - path: models/tinybert_saved_model
      hash: md5
      md5: 5c5a661df2b258e8ea0e5bcd288c238c.dir
      size: 18495514
      nfiles: 6
    params:
      params.yaml:
        measure.batch_sizes:
        - 1
        - 2
        - 4
        - 8
        - 16
        - 32
        - 64
        - 128
        - 256
        - 512
        - 1024
    outs:
    - path: eval_results/accuracy_FP16.json
      hash: md5
      md5: e32b7b05a9224aad9ce8967d8dd14c0e
      size: 68
    - path: throughput/FP16/latency_results.json
      hash: md5
      md5: 6d63833488e67d35b3b82980aaf40b4d
      size: 3574
    - path: throughput/FP16/latency_results_batch.json
      hash: md5
      md5: 6641f316b497239beb081c14bcb091be
      size: 3531
    - path: throughput/FP16/throughput_results.json
      hash: md5
      md5: 2f34358d0b69d284b5d16971bd38dd28
      size: 1629
    - path: throughput/FP16/throughput_results_2.json
      hash: md5
      md5: 2f34358d0b69d284b5d16971bd38dd28
      size: 1629
  measure_INT8:
    cmd: INT8=1 python code/measure_general.py
    deps:
    - path: code/measure_general.py
      hash: md5
      md5: ce93c358007215235fcd5c7c88602b97
      size: 24119
    - path: code/plot_templates/bar_1_INT8.json
      hash: md5
      md5: 512d0d97671e22f804d637ba1230baff
      size: 515
    - path: code/plot_templates/bar_2_INT8.json
      hash: md5
      md5: 079cf62477a8b45cfd74c52f9c826f00
      size: 528
    - path: code/plot_templates/bar_3_INT8.json
      hash: md5
      md5: a44e05205624dcffd0bf99af17df8027
      size: 609
    - path: code/plot_templates/bar_4_INT8.json
      hash: md5
      md5: 9a82c709579ef72d64518fa009ddee1f
      size: 629
    - path: datasets/tokenized_agnews_test.pt
      hash: md5
      md5: 1e73b549c83c233f23f3f6c35db9a51d
      size: 15627871
    - path: models/tinybert_int8/model.onnx
      hash: md5
      md5: fc21e2cb9a2778c869fcc614a5a60c4d
      size: 17639925
    - path: models/tinybert_saved_model
      hash: md5
      md5: 5c5a661df2b258e8ea0e5bcd288c238c.dir
      size: 18495514
      nfiles: 6
    params:
      params.yaml:
        measure.batch_sizes:
        - 1
        - 2
        - 4
        - 8
        - 16
        - 32
        - 64
        - 128
        - 256
        - 512
        - 1024
    outs:
    - path: eval_results/accuracy_INT8.json
      hash: md5
      md5: 87814bc7455fd870bc65f24cc96763f9
      size: 68
    - path: throughput/INT8/latency_results.json
      hash: md5
      md5: a39d18e6a1195e85f503832b17a3b223
      size: 3568
    - path: throughput/INT8/latency_results_batch.json
      hash: md5
      md5: 960a4c95fa25dd69cc861b0d71624dc6
      size: 3526
    - path: throughput/INT8/throughput_results.json
      hash: md5
      md5: 4f8c65349b91c5d66331d9e2bd20db3f
      size: 1617
    - path: throughput/INT8/throughput_results_2.json
      hash: md5
      md5: 4f8c65349b91c5d66331d9e2bd20db3f
      size: 1617
  accuracy_comparison:
    cmd: python code/accuracy_comparison.py
    deps:
    - path: code/accuracy_comparison.py
      hash: md5
      md5: 2a8833667c4a0d4c37c64cbf1123a89b
      size: 878
    - path: eval_results/accuracy_FP16.json
      hash: md5
      md5: e32b7b05a9224aad9ce8967d8dd14c0e
      size: 68
    - path: eval_results/accuracy_FP32.json
      hash: md5
      md5: ff4e14772ceefa34274252c24e601710
      size: 54
    - path: eval_results/accuracy_INT8.json
      hash: md5
      md5: 87814bc7455fd870bc65f24cc96763f9
      size: 68
    - path: eval_results/accuracy_INT8_tensorrt.json
      hash: md5
      md5: 1dc83ff593f42270131fc45be294d5f4
      size: 77
    outs:
    - path: eval_results/accuracy.json
      hash: md5
      md5: cef611216ede4715c3c76db242c2d09a
      size: 341
  quantize_tensorrt_INT8:
    cmd: python code/tensorrt_quant.py
    deps:
    - path: code/tensorrt_quant.py
      hash: md5
      md5: 70296c40a5d334c985453b6d405ed17f
      size: 4404
    - path: models/tinybert_saved_model
      hash: md5
      md5: 5c5a661df2b258e8ea0e5bcd288c238c.dir
      size: 18495514
      nfiles: 6
    params:
      params.yaml:
        train.batch_size: 64
    outs:
    - path: models/engines
      hash: md5
      md5: ab1563d0ca40957ad8e8e48ca39a6f0b.dir
      size: 198140164
      nfiles: 11
  quantize_int8:
    cmd: python code/brevitas_quant.py
    deps:
    - path: code/brevitas_quant.py
      hash: md5
      md5: abe1004b4cf9d3bb3d8f27261bf854a5
      size: 1625
    - path: models/tinybert.onnx
      hash: md5
      md5: 5343fcd950c7c75e23125de929418e9a
      size: 17603568
    outs:
    - path: models/tinybert_int8/model.onnx
      hash: md5
      md5: fc21e2cb9a2778c869fcc614a5a60c4d
      size: 17639925
  measure_INT8_tensorrt:
    cmd: python code/measure_int8_tensorrt.py
    deps:
    - path: code/measure_int8_tensorrt.py
      hash: md5
      md5: 826d5a8386c6078cd01351ca5bdc234e
      size: 20973
    - path: code/plot_templates/bar_1_INT8_tensorrt.json
      hash: md5
      md5: 998b3034452bb8426e05b78d35466daa
      size: 525
    - path: code/plot_templates/bar_2_INT8_tensorrt.json
      hash: md5
      md5: 07c97dc8993669e7e12d788a5fe93364
      size: 538
    - path: code/plot_templates/bar_3_INT8_tensorrt.json
      hash: md5
      md5: 45f7b553dccd6e3b05ba9dd211e39177
      size: 619
    - path: code/plot_templates/bar_4_INT8_tensorrt.json
      hash: md5
      md5: a4a94b5e313ab0a49fc7a80412d7743f
      size: 639
    - path: datasets/tokenized_agnews_test.pt
      hash: md5
      md5: 1e73b549c83c233f23f3f6c35db9a51d
      size: 15627871
    - path: models/engines
      hash: md5
      md5: ab1563d0ca40957ad8e8e48ca39a6f0b.dir
      size: 198140164
      nfiles: 11
    params:
      params.yaml:
        measure.batch_sizes:
        - 1
        - 2
        - 4
        - 8
        - 16
        - 32
        - 64
        - 128
        - 256
        - 512
        - 1024
    outs:
    - path: eval_results/accuracy_INT8_tensorrt.json
      hash: md5
      md5: 1dc83ff593f42270131fc45be294d5f4
      size: 77
    - path: throughput/INT8_tensorrt/latency_results.json
      hash: md5
      md5: d6e5384f6e9e5e5994e8dc50fce6d02b
      size: 3572
    - path: throughput/INT8_tensorrt/latency_results_batch.json
      hash: md5
      md5: b5f3c184f2741165f45069b0f04bb1a8
      size: 3533
    - path: throughput/INT8_tensorrt/throughput_results.json
      hash: md5
      md5: 6bd1cbd7528638ae340688caa45317f8
      size: 1625
    - path: throughput/INT8_tensorrt/throughput_results_2.json
      hash: md5
      md5: 6bd1cbd7528638ae340688caa45317f8
      size: 1625
  energy_measure:
    cmd: python code/energy_tegrastats.py
    deps:
    - path: code/energy_tegrastats.py
      hash: md5
      md5: 138ab1f71ac03cd5320fc7f7cda8f26f
      size: 14565
    - path: code/parse_tegrastats_to_json.py
      hash: md5
      md5: bd4871fc649f95b4e5f7c2280517fd84
      size: 2873
    outs:
    - path: energy_metrics/energy_metrics.json
      hash: md5
      md5: 5442ec614a56cf49a56bcc9413476f3b
      size: 15836
    - path: energy_metrics/tegrastats.log
      hash: md5
      md5: dfc340ac938fee2ab16adeb7097148c3
      size: 14802
