schema: '2.0'
stages:
  train:
    cmd: python code/tiny_train.py
    deps:
    - path: code/bert_dataset.py
      hash: md5
      md5: 1bc519848a6cc5be3af42e81e9372f46
      size: 18331
    - path: code/tiny_train.py
      hash: md5
      md5: 4a12587c5106e2749e0be8b876db3735
      size: 2914
    params:
      params.yaml:
        train.batch_size: 16
        train.d_model: 768
        train.dropout: 0.1
        train.epochs: 5
        train.heads: 12
        train.lr: 0.0001
        train.weight_decay: 0.01
    outs:
    - path: models/tinybert_saved_model
      hash: md5
      md5: 20085006f7631438fddcf692f1550367.dir
      size: 18495514
      nfiles: 6
  export:
    cmd: python code/export.py
    deps:
    - path: code/export.py
      hash: md5
      md5: 84e8faba77ac3eac6903a38c2cd2c2c1
      size: 1279
    - path: models/tinybert_saved_model
      hash: md5
      md5: 20085006f7631438fddcf692f1550367.dir
      size: 18495514
      nfiles: 6
    outs:
    - path: models/tinybert.onnx
      hash: md5
      md5: 3942cfe2d45d44291cc7fbe7ad08b9a8
      size: 17603568
  evaluate:
    cmd: python code/evaluate_model.py
    deps:
    - path: code/evaluate_model.py
      hash: md5
      md5: 9ca508087b32a5155746e638d5a9e316
      size: 2011
    - path: models/tinybert_saved_model
      hash: md5
      md5: 20085006f7631438fddcf692f1550367.dir
      size: 18495514
      nfiles: 6
  measure:
    cmd: python code/measure_quantized.py
    deps:
    - path: code/bar_1.json
      hash: md5
      md5: 1abfce1ddffdd19b77a5a827b726a824
      size: 474
    - path: code/bar_2.json
      hash: md5
      md5: 77565dd0c332852d5f4c81098fc7e689
      size: 484
    - path: code/bar_3.json
      hash: md5
      md5: 6ba9c58f2f53a67b418881645060cb70
      size: 591
    - path: code/bar_4.json
      hash: md5
      md5: c30440284b82ff8b40f4dedae38c9992
      size: 592
    - path: code/measure_quantized.py
      hash: md5
      md5: 5d4d19cb119831b47f6d7ad5961fb37b
      size: 14425
    - path: datasets/tokenized_agnews_test.pt
      hash: md5
      md5: db0ea7f0705e65f4873ac08d1a160cc8
      size: 15627446
    - path: models/tinybert_saved_model
      hash: md5
      md5: 20085006f7631438fddcf692f1550367.dir
      size: 18495514
      nfiles: 6
    - path: quantized_model_int8.trt
      hash: md5
      md5: 63dc575644fd8212d6d1aac30a15fce4
      size: 18806292
    outs:
    - path: throughput/latency_results.json
      hash: md5
      md5: b1e2ea1a96f5a96546862f0612e1f4ca
      size: 3599
    - path: throughput/latency_results_batch.json
      hash: md5
      md5: eb45efdedb5554cbe960d96dd5f101cb
      size: 3571
    - path: throughput/throughput_results.json
      hash: md5
      md5: 12e5a2f20cf5d318c3deca1151acd66d
      size: 1623
    - path: throughput/throughput_results_2.json
      hash: md5
      md5: 12e5a2f20cf5d318c3deca1151acd66d
      size: 1623
  quantize:
    cmd: python code/quantize.py
    deps:
    - path: code/quantize.py
      hash: md5
      md5: ff19a65f5e4f5a70ec9b0b8867c5b751
      size: 4076
    - path: models/tinybert.onnx
      hash: md5
      md5: 3942cfe2d45d44291cc7fbe7ad08b9a8
      size: 17603568
    outs:
    - path: quantized_model_int8.trt
      hash: md5
      md5: 63dc575644fd8212d6d1aac30a15fce4
      size: 18806292
